{% extends "base.html" %}
{% block title %}메인화면{% endblock title %}
{% block style %}
<style>
  ._abl-1{align-items:center;background:transparent;border:none;cursor:pointer;display:flex;justify-content:center;padding:8px}._abl_{display:block}._abm0{align-items:center;display:flex;justify-content:center}._abl-:hover ._abl_{display:none}._abm1{display:none}._abl-:hover ._abm1{display:block}._abm2{padding:0}._abm3{cursor:default}
  ._abl-2{align-items:center;background:transparent;border:none;cursor:pointer;display:flex;justify-content:center;padding:8px}._abl_{display:block}._abm0{align-items:center;display:flex;justify-content:center}._abl-:hover ._abl_{display:none}._abm1{display:none}._abl-:hover ._abm1{display:block}._abm2{padding:0}._abm3{cursor:default}
</style>
{% endblock style %}
{% block content %}
<header class="header-2">
  <div class="page-header relative">
	<div class="container mb-5">
		<span class="mask bg-primary opacity-4"></span>
		<div class="row" style="margin-top: 90px"></div>
		<div class="row">
		  <div class="col-12">
			<div class="container blur border-radius-xl p-2 mt-4 z-index-2">
			  <div class="row">
				<!--page-header blur border-radius-xl py-5 py-md-4 my-sm-3 mb-3-->
				<div class="col py-3">
				  <div class="container">
					<div class="row">
					  <div class="col-sm">
						<h4 class="display-4">{{ today }}의 일기</h4>
						<!-- <h4 class="display-4">Diary <small class="text-muted" style="font-size : 60%">at {{ today }}</small></h4> -->
					  </div>
					</div>
					{% if diary_list %}
					<div class="row">
					  {% for diary in diary_list %}
					  <div class="col-md-4 mt-4 my-4"">
						<div class="card h-100" data-animation="false">
						  <div class="card-header p-0 position-relative mt-4 mx-3 z-index-2">
							<a class="d-block blur-shadow-image">
							  <img
								src="{{ diary.image_set.all.0.url }}"
								alt="img-blur-shadow" class="img-fluid shadow border-radius-lg">
							</a>
							<!-- <div class="colored-shadow"
							  style="background-image: url(&quot;https://demos.creative-tim.com/test/material-dashboard-pro/assets/img/products/product-1-min.jpg&quot;);">
							</div> -->
						  </div>
						  <div class="card-body">
							<!-- <h5 class="font-weight-normal mt-3 text-center">
							  <a href="{% url 'earth_diary:detail' diary.id %}">{{ diary.keyword }}</a>
							</h5> -->
                <a href="{% url 'earth_diary:detail' diary.id %}">
                  <p class="mb-0 font-weight-normal" style="font-family: EarlyFontDiary;">
                    {{ diary.content }}
                  </p>
                </a>
						  </div>
						  <hr class="dark horizontal my-0">
						  <div class="card-footer d-flex">
							<p class="font-weight-normal my-auto"></p>
							{% if userid %}
							  {% if diary.heart_set.all.0.userid == userid %}
							  <span class="_aamw"><button class="_abl-2" type="button" id="{% url 'earth_diary:heart' diary.id userid %}"><div class="_abm0"><span class="_aame"><svg aria-label="좋아요 취소" class="_ab6-" color="#ed4956" fill="#ed4956" height="24" role="img" viewBox="0 0 48 48" width="24"><path d="M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"></path></svg></span></div></button></span>
							  {% else %}
							  <span class="_aamw"><button class="_abl-1" type="button" id="{% url 'earth_diary:heart' diary.id userid %}"><div class="_abm0 _abm1"><svg aria-label="좋아요" class="_ab6-" color="#8e8e8e" fill="#8e8e8e" height="24" role="img" viewBox="0 0 24 24" width="24"><path d="M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"></path></svg></div><div class="_abm0 _abl_"><span class="_aame"><svg aria-label="좋아요" class="_ab6-" color="#262626" fill="#262626" height="24" role="img" viewBox="0 0 24 24" width="24"><path d="M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"></path></svg></span></div></button></span>
							  {% endif %}
							{% endif %}
							<i class="material-icons position-relative ms-auto text-lg me-1 my-auto">place</i>
							<p class="text-sm my-auto">{{ diary.state }}</p>
						  </div>
						</div>
					  </div>
					  {% endfor %}
					</div>
					{% else %}
					<p>준비중 입니다.</p>
					{% endif %}
				  </div>
				</div>
			  </div>
			  <div class="row">
				<div class="col-5 mx-auto">
				  <a href="{% url 'earth_diary:date' prev_date %}">
					<button type="button" class="btn btn-default mb-0 float-start">
					  <p class="mb-0 ps-2"><strong>
						  <- 하루 전</strong>
					  </p>
					</button>
				  </a>
				</div>
				<div class="col-5 mx-auto">
				  <a href="{% url 'earth_diary:date' next_date %}">
					<button type="button" class="btn btn-default mb-0 float-end">
					  <p class="mb-0 ps-2"><strong>하루 뒤 -></strong></p>
					</button>
				  </a>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
  </div>
</header>
{% endblock content %}
{% block javascripts %}
<script nonce="{{ request.csp_nonce }}" type="text/javascript">
  const hearts = document.getElementsByClassName("_abl-1");
  for (let i = 0; i < hearts.length; i++) {
    hearts[i].addEventListener("click", function(evnt){
      enable_heart(this)
    });
  }
  const hearts_fill = document.getElementsByClassName("_abl-2");
  for (let i = 0; i < hearts_fill.length; i++) {
    hearts_fill[i].addEventListener("click", function(evnt){
      disable_heart(this)
    });
  }
  const removeChilds = (parent) => {
    while (parent.lastChild) {
      parent.removeChild(parent.lastChild);
    }
  };
  function disable_heart(element) {
    let xhr = new XMLHttpRequest();
    xhr.open("GET", element.id, true);
    xhr.send()
    xhr.onload = function() {
      const heart = document.createElement('button');
      heart.setAttribute('class', '_abl-1');
      heart.setAttribute('type', 'button');
      heart.setAttribute('id', element.id);
      heart.addEventListener("click", function(evnt){
        enable_heart(this)
      });
      heart.innerHTML = '<div class="_abm0 _abm1"><svg aria-label="좋아요" class="_ab6-" color="#8e8e8e" fill="#8e8e8e" height="24" role="img" viewBox="0 0 24 24" width="24"><path d="M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"></path></svg></div><div class="_abm0 _abl_"><span class="_aame"><svg aria-label="좋아요" class="_ab6-" color="#262626" fill="#262626" height="24" role="img" viewBox="0 0 24 24" width="24"><path d="M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"></path></svg></span></div>';
      const span = element.parentNode;
      removeChilds(span);
      span.appendChild(heart);
    }
  }
  function enable_heart(element) {
    let xhr = new XMLHttpRequest();
    xhr.open("GET", element.id, true);
    xhr.send()
    xhr.onload = function() {
      const heart_filled = document.createElement('button');
      heart_filled.setAttribute('class', '_abl-2');
      heart_filled.setAttribute('type', 'button');
      heart_filled.setAttribute('id', element.id);
      heart_filled.addEventListener("click", function(evnt){
        disable_heart(this)
      });
      heart_filled.innerHTML = '<div class="_abm0"><span class="_aame"><svg aria-label="좋아요 취소" class="_ab6-" color="#ed4956" fill="#ed4956" height="24" role="img" viewBox="0 0 48 48" width="24"><path d="M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"></path></svg></span></div>';
      const span = element.parentNode;
      removeChilds(span);
      span.appendChild(heart_filled);
    }
  }
</script>
{% endblock javascripts %}